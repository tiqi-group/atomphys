stages:
  - prepare
  - lint
#   - test

cache:
  key: python-venv
  paths:
    - .venv

prepare:
  stage: prepare
  tags:
    - py3.10
  script:
    - poetry install

# test:
#   stage: test
#   tags:
#     - py3.10
#   script:
#     - poetry run pytest -v


lint_autopep8:
  stage: lint
  tags:
    - py3.10

  script:
    - |
      CHANGES=$(poetry run autopep8 --diff --recursive .)
      if [ -n "$CHANGES" ]; then
        echo "autopep8 found the following changes:"
        echo "$CHANGES"
        exit 1
      fi


lint_flake8:
  stage: lint
  tags:
    - py3.10
  script:
    - |
      VIOLATIONS=$(flake8)
      if [ -n "$VIOLATIONS" ]; then
        echo "flake8 found the following style violations:"
        echo "$VIOLATIONS"
        exit 1
      fi


